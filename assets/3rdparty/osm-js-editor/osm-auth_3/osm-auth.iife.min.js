/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/osm-auth@3.0.0/dist/osm-auth.iife.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var osmAuth=(function(){var A=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var W=function(t,e){for(var f in e)A(t,f,{get:e[f],enumerable:!0})},H=function(t,e,f,l){if(e&&typeof e=="object"||typeof e=="function")for(var d=x(e),i=0,p=d.length,h;i<p;i++)h=d[i],!E.call(t,h)&&h!==f&&A(t,h,{get:function(w){return e[w]}.bind(null,h),enumerable:!(l=T(e,h))||l.enumerable});return t};var L=function(t){return H(A({},"__esModule",{value:!0}),t)};var N={};W(N,{osmAuth:function(){return q}});function q(t){var e={},f="osm-api-auth-complete",l=null;try{l=window.localStorage}catch(r){var d=new Map;l={isMocked:!0,hasItem:function(n){return d.has(n)},getItem:function(n){return d.get(n)},setItem:function(n,o){return d.set(n,o)},removeItem:function(n){return d.delete(n)},clear:function(){return d.clear()}}}function i(r,n){var o=t.url+r;if(arguments.length===1){var u=l.getItem(o)||"";return u.replace(/"/g,"")}else if(arguments.length===2)return n?l.setItem(o,n):l.removeItem(o)}e.authenticated=function(){return!!i("oauth2_access_token")},e.logout=function(){return i("oauth2_access_token",""),i("oauth_token",""),i("oauth_token_secret",""),i("oauth_request_token_secret",""),e},e.authenticate=function(r,n){if(e.authenticated()){r(null,e);return}e.logout(),p(function(o,u){o?r(o):R(function(a){h(a,n,u,r)})})},e.authenticateAsync=function(r){return e.authenticated()?Promise.resolve(e):(e.logout(),new Promise(function(n,o){var u=function(a,s){a?o(a):n(s)};p(function(a,s){a?u(a):R(function(c){return h(c,r,s,u)})})}))};function p(r){if(t.singlepage){r(null,void 0);return}var n=550,o=610,u=[["width",n],["height",o],["left",window.screen.width/2-n/2],["top",window.screen.height/2-o/2]].map(function(c){return c.join("=")}).join(","),a=window.open("about:blank","oauth_window",u);if(a)r(null,a);else{var s=new Error("Popup was blocked");s.status="popup-blocked",r(s)}}function h(r,n,o,u){var a=z(),s="/oauth2/authorize?"+k({client_id:t.client_id,redirect_uri:t.redirect_uri,response_type:"code",scope:t.scope,state:a,code_challenge:r.code_challenge,code_challenge_method:r.code_challenge_method,locale:t.locale||""}),c=n!=null&&n.switchUser?"".concat(t.url,"/logout?referer=").concat(encodeURIComponent("/login?referer=".concat(encodeURIComponent(s)))):t.url+s;if(t.singlepage){if(l.isMocked){var _=new Error("localStorage unavailable, but required in singlepage mode");_.status="pkce-localstorage-unavailable",u(_);return}var g=C(window.location.search.slice(1));g.code?e.bootstrapToken(g.code,u):(i("oauth2_state",a),i("oauth2_pkce_code_verifier",r.code_verifier),window.location=c)}else e.popupWindow=o,o.location=c;var v=new BroadcastChannel(f);v.addEventListener("message",function(m){var I=m.data,y=C(I.split("?")[1]);if(y.state!==a){var S=new Error("Invalid state");S.status="invalid-state",u(S);return}w(y.code,r.code_verifier,P),v.close()});function P(m,I){if(t.done(),m){u(m);return}var y=JSON.parse(I.response);i("oauth2_access_token",y.access_token),u(null,e)}}function w(r,n,o){var u=t.url+"/oauth2/token?"+k({client_id:t.client_id,redirect_uri:t.redirect_uri,grant_type:"authorization_code",code:r,code_verifier:n});e.rawxhr("POST",u,null,null,null,o),t.loading()}return e.bringPopupWindowToFront=function(){var r=!1;try{e.popupWindow&&!e.popupWindow.closed&&(e.popupWindow.focus(),r=!0)}catch(n){}return r},e.bootstrapToken=function(r,n){var o=i("oauth2_state");i("oauth2_state","");var u=C(window.location.search.slice(1));if(u.state!==o){var a=new Error("Invalid state");a.status="invalid-state",n(a);return}var s=i("oauth2_pkce_code_verifier");i("oauth2_pkce_code_verifier",""),w(r,s,c);function c(_,g){if(t.done(),_){n(_);return}var v=JSON.parse(g.response);i("oauth2_access_token",v.access_token),n(null,e)}},e.fetch=function(r,n){if(e.authenticated())return o();return t.auto?e.authenticateAsync().then(o):Promise.reject(new Error("not authenticated"));function o(){return n=n||{},n.headers||(n.headers={"Content-Type":"application/x-www-form-urlencoded"}),n.headers.Authorization="Bearer "+i("oauth2_access_token"),fetch(r,n)}},e.xhr=function(r,n){if(e.authenticated())return o();if(t.auto){e.authenticate(o);return}else{n("not authenticated",null);return}function o(){var a=r.prefix!==!1?t.apiUrl+r.path:r.path;return e.rawxhr(r.method,a,i("oauth2_access_token"),r.content,r.headers,u)}function u(a,s){a?n(a):s.responseXML?n(a,s.responseXML):n(a,s.response)}},e.rawxhr=function(r,n,o,u,a,s){a=a||{"Content-Type":"application/x-www-form-urlencoded"},o&&(a.Authorization="Bearer "+o);var c=new XMLHttpRequest;c.onreadystatechange=function(){c.readyState===4&&c.status!==0&&(/^20\d$/.test(c.status)?s(null,c):s(c,null))},c.onerror=function(g){s(g,null)},c.open(r,n,!0);for(var _ in a)c.setRequestHeader(_,a[_]);return c.send(u),c},e.preauth=function(r){return r&&r.access_token&&i("oauth2_access_token",r.access_token),e},e.options=function(r){return arguments.length?(t=r,t.apiUrl=t.apiUrl||"https://api.openstreetmap.org",t.url=t.url||"https://www.openstreetmap.org",t.auto=t.auto||!1,t.singlepage=t.singlepage||!1,t.loading=t.loading||function(){},t.done=t.done||function(){},e.preauth(t)):t},e.options(t),e}function k(t){return Object.keys(t).filter(function(e){return t[e]!==void 0}).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function C(t){for(var e=0;e<t.length&&(t[e]==="?"||t[e]==="#");)e++;return t=t.slice(e),t.split("&").reduce(function(f,l){var d=l.split("=");return d.length===2&&(f[d[0]]=decodeURIComponent(d[1])),f},{})}function M(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function R(t){var e;if(M()){var f=window.crypto.getRandomValues(new Uint8Array(32));e=U(f.buffer);var l=Uint8Array.from(Array.from(e).map(function(p){return p.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",l).then(function(p){var h=U(p);t({code_challenge:h,code_verifier:e,code_challenge_method:"S256"})})}else{var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var i=0;i<64;i++)e+=d[Math.floor(Math.random()*d.length)];t({code_verifier:e,code_challenge:e,code_challenge_method:"plain"})}}function z(){var t;if(M()){var e=window.crypto.getRandomValues(new Uint8Array(32));t=U(e.buffer)}else{var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";t="";for(var l=0;l<64;l++)t+=f[Math.floor(Math.random()*f.length)]}return t}function U(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}return L(N);})();
//# sourceMappingURL=osm-auth.iife.js.map